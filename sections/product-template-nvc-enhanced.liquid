{% comment %}
  Enhanced Product Template for New Vantage Co
  Includes ILS integration, optical features, and modern animations
  
  Usage: Assign this template to products in the product admin
{% endcomment %}

<div class="product-template-nvc" data-section-id="{{ section.id }}" data-section-type="product" data-product-id="{{ product.id }}">
  
  <div class="container">
    <div class="row" data-nvc-animate="fade">
      
      {% comment %} Product Images - Left Column {% endcomment %}
      <div class="col-12 col-md-6">
        <div class="product-images nvc-stagger">
          
          {% comment %} Main Image {% endcomment %}
          <div class="product-main-image nvc-hover-lift" data-nvc-animate="scale">
            {% if product.featured_image %}
              <img 
                src="{{ product.featured_image | img_url: '1000x1000' }}"
                srcset="{{ product.featured_image | img_url: '500x500' }} 500w,
                        {{ product.featured_image | img_url: '1000x1000' }} 1000w,
                        {{ product.featured_image | img_url: '1500x1500' }} 1500w"
                sizes="(max-width: 768px) 100vw, 50vw"
                alt="{{ product.featured_image.alt | escape }}"
                loading="eager"
                width="1000"
                height="1000">
            {% else %}
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {% endif %}
          </div>
          
          {% comment %} Thumbnail Gallery {% endcomment %}
          {% if product.images.size > 1 %}
          <div class="product-thumbnails" data-nvc-animate="slide-left">
            <div class="thumbnails-grid">
              {% for image in product.images limit: 5 %}
                <div class="thumbnail-item {% if forloop.first %}active{% endif %} nvc-hover-lift">
                  <img 
                    src="{{ image | img_url: '200x200' }}"
                    alt="{{ image.alt | escape }}"
                    loading="lazy"
                    width="200"
                    height="200">
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          
        </div>
      </div>
      
      {% comment %} Product Details - Right Column {% endcomment %}
      <div class="col-12 col-md-6">
        <div class="product-details">
          
          {% comment %} Breadcrumb {% endcomment %}
          <nav class="product-breadcrumb" aria-label="Breadcrumb" data-nvc-animate="fade">
            <a href="/">Home</a>
            <span>/</span>
            {% if collection %}
              <a href="{{ collection.url }}">{{ collection.title }}</a>
              <span>/</span>
            {% endif %}
            <span>{{ product.title }}</span>
          </nav>
          
          {% comment %} Product Title {% endcomment %}
          <h1 class="product-title" data-nvc-animate="slide-right">
            {{ product.title }}
          </h1>
          
          {% comment %} Product Vendor/Brand {% endcomment %}
          {% if product.vendor %}
          <div class="product-vendor" data-nvc-animate="fade">
            <a href="{{ product.vendor | url_for_vendor }}">{{ product.vendor }}</a>
          </div>
          {% endif %}
          
          {% comment %} Product Rating (if using reviews app) {% endcomment %}
          <div class="product-rating" data-nvc-animate="fade">
            <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
          </div>
          
          {% comment %} Product Price {% endcomment %}
          <div class="product-price-wrapper" data-nvc-animate="slide-right">
            <div class="product-price">
              <span class="price">
                {{ product.selected_or_first_available_variant.price | money }}
              </span>
              {% if product.compare_at_price > product.price %}
                <span class="compare-price">
                  {{ product.selected_or_first_available_variant.compare_at_price | money }}
                </span>
                <span class="price-badge">Save {{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%</span>
              {% endif %}
            </div>
            <div class="nvc-price-vat">
              <small>Inc. UK VAT</small>
            </div>
          </div>
          
          {% comment %} Product Description {% endcomment %}
          <div class="product-description rte" data-nvc-animate="fade">
            {{ product.description }}
          </div>
          
          {% comment %} ILS Integration - Real-time Inventory {% endcomment %}
          <div data-nvc-animate="slide-left">
            {%- render 'ils-integration', product: product -%}
          </div>
          
          {% comment %} Variant Selector {% endcomment %}
          {% unless product.has_only_default_variant %}
          <div class="product-variants" data-nvc-animate="fade">
            {% form 'product', product %}
              <select name="id" class="product-variant-select">
                {% for variant in product.variants %}
                  <option 
                    value="{{ variant.id }}"
                    {% if variant == product.selected_or_first_available_variant %}selected{% endif %}
                    {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }} - {{ variant.price | money }}
                    {% unless variant.available %} - Sold Out{% endunless %}
                  </option>
                {% endfor %}
              </select>
            {% endform %}
          </div>
          {% endunless %}
          
          {% comment %} Quantity Selector {% endcomment %}
          <div class="product-quantity" data-nvc-animate="fade">
            <label for="quantity">Quantity</label>
            <div class="quantity-selector">
              <button type="button" class="qty-btn minus" aria-label="Decrease quantity">−</button>
              <input 
                type="number" 
                id="quantity" 
                name="quantity" 
                value="1" 
                min="1"
                aria-label="Quantity">
              <button type="button" class="qty-btn plus" aria-label="Increase quantity">+</button>
            </div>
          </div>
          
          {% comment %} Add to Cart Button {% endcomment %}
          <div class="product-actions" data-nvc-animate="slide-right">
            <button 
              type="submit" 
              name="add" 
              class="btn btn-primary btn-add-to-cart nvc-hover-lift"
              {% unless product.available %}disabled{% endunless %}>
              {% if product.available %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                Add to Cart
              {% else %}
                Sold Out
              {% endif %}
            </button>
            
            {% comment %} Wishlist Button {% endcomment %}
            <button type="button" class="btn btn-outline btn-wishlist nvc-hover-lift" aria-label="Add to wishlist">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
            </button>
          </div>
          
          {% comment %} Trust Badges {% endcomment %}
          <div class="product-trust-badges nvc-stagger" data-nvc-animate="fade">
            <div class="trust-badge">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 6L9 17l-5-5"></path>
              </svg>
              <span>Free UK Delivery</span>
            </div>
            <div class="trust-badge">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
              <span>2-Year Guarantee</span>
            </div>
            <div class="trust-badge">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
              </svg>
              <span>Easy Returns</span>
            </div>
          </div>
          
          {% comment %} Optical Product Features {% endcomment %}
          <div data-nvc-animate="fade">
            {%- render 'optical-product-features', product: product -%}
          </div>
          
          {% comment %} Accordion Details {% endcomment %}
          <div class="product-accordion" data-nvc-animate="fade">
            
            <details class="accordion-item">
              <summary class="accordion-header">
                <span>Product Details</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </summary>
              <div class="accordion-content">
                <ul>
                  {% if product.metafields.details.material %}
                    <li><strong>Material:</strong> {{ product.metafields.details.material }}</li>
                  {% endif %}
                  {% if product.metafields.details.made_in %}
                    <li><strong>Made in:</strong> {{ product.metafields.details.made_in }}</li>
                  {% endif %}
                  {% if product.weight > 0 %}
                    <li><strong>Weight:</strong> {{ product.weight | weight_with_unit }}</li>
                  {% endif %}
                </ul>
              </div>
            </details>
            
            <details class="accordion-item">
              <summary class="accordion-header">
                <span>Shipping & Returns</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </summary>
              <div class="accordion-content">
                <p><strong>Free UK Delivery</strong> on all orders over £50</p>
                <p><strong>Returns:</strong> 30-day return policy. Items must be unworn and in original packaging.</p>
                <p><strong>International:</strong> Worldwide shipping available with customs fees at checkout.</p>
              </div>
            </details>
            
            <details class="accordion-item">
              <summary class="accordion-header">
                <span>Frame Care</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </summary>
              <div class="accordion-content">
                <ul>
                  <li>Clean lenses with microfiber cloth</li>
                  <li>Use mild soap and water for frames</li>
                  <li>Store in protective case when not in use</li>
                  <li>Avoid extreme temperatures</li>
                  <li>Handle with both hands to maintain alignment</li>
                </ul>
              </div>
            </details>
            
          </div>
          
          {% comment %} Social Share {% endcomment %}
          <div class="product-share" data-nvc-animate="fade">
            <span class="share-label">Share:</span>
            <div class="share-buttons">
              <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ product.url }}" 
                 target="_blank" 
                 class="share-btn nvc-hover-lift"
                 aria-label="Share on Facebook">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                </svg>
              </a>
              <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ product.url }}&text={{ product.title | url_encode }}" 
                 target="_blank" 
                 class="share-btn nvc-hover-lift"
                 aria-label="Share on Twitter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                </svg>
              </a>
              <a href="https://pinterest.com/pin/create/button/?url={{ shop.url }}{{ product.url }}&media={{ product.featured_image | img_url: '1000x1000' }}&description={{ product.title | url_encode }}" 
                 target="_blank" 
                 class="share-btn nvc-hover-lift"
                 aria-label="Share on Pinterest">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M8 12a4 4 0 0 1 8 0c0 1.657-1.343 3-3 3-.657 0-1.343-.343-1.343-1 0-.657.343-1 1-1h1" stroke="white" fill="none" stroke-width="2"></path>
                </svg>
              </a>
            </div>
          </div>
          
        </div>
      </div>
      
    </div>
  </div>
  
  {% comment %} Related Products {% endcomment %}
  {% if section.settings.show_related_products %}
  <div class="related-products" data-nvc-animate="fade">
    <div class="container">
      <h2 class="section-title">You May Also Like</h2>
      <div class="product-grid nvc-stagger">
        {% comment %} Your related products logic here {% endcomment %}
      </div>
    </div>
  </div>
  {% endif %}
  
</div>

<style>
/* Product Template Styles */
.product-template-nvc {
  padding: 2rem 0;
}

.product-images {
  position: sticky;
  top: 100px;
}

.product-main-image {
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 1rem;
}

.product-main-image img {
  width: 100%;
  height: auto;
  display: block;
}

.product-thumbnails {
  margin-top: 1rem;
}

.thumbnails-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.5rem;
}

.thumbnail-item {
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  transition: border-color 0.2s ease;
}

.thumbnail-item:hover,
.thumbnail-item.active {
  border-color: #000;
}

.thumbnail-item img {
  width: 100%;
  height: auto;
  display: block;
}

.product-details {
  padding-left: 2rem;
}

.product-breadcrumb {
  font-size: 0.85rem;
  color: #666;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.product-breadcrumb a {
  color: #000;
  text-decoration: none;
}

.product-breadcrumb a:hover {
  text-decoration: underline;
}

.product-title {
  font-size: 2.5rem;
  font-weight: 600;
  margin: 0 0 0.5rem 0;
  line-height: 1.2;
}

.product-vendor {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 1rem;
}

.product-vendor a {
  color: #000;
  text-decoration: none;
  font-weight: 500;
}

.product-rating {
  margin-bottom: 1rem;
}

.product-price-wrapper {
  padding: 1.5rem 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 1.5rem;
}

.product-price {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.price {
  font-size: 2rem;
  font-weight: 600;
}

.compare-price {
  font-size: 1.5rem;
  color: #999;
  text-decoration: line-through;
}

.price-badge {
  background: #e74c3c;
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
}

.product-description {
  margin-bottom: 2rem;
  line-height: 1.6;
  color: #333;
}

.product-variants {
  margin-bottom: 1.5rem;
}

.product-variant-select {
  width: 100%;
  padding: 1rem;
  border: 2px solid rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: border-color 0.2s ease;
}

.product-variant-select:hover,
.product-variant-select:focus {
  border-color: #000;
  outline: none;
}

.product-quantity {
  margin-bottom: 1.5rem;
}

.product-quantity label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.quantity-selector {
  display: flex;
  align-items: center;
  border: 2px solid rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  width: fit-content;
}

.qty-btn {
  width: 40px;
  height: 40px;
  border: none;
  background: none;
  font-size: 1.2rem;
  cursor: pointer;
  transition: background 0.2s ease;
}

.qty-btn:hover {
  background: rgba(0, 0, 0, 0.05);
}

.quantity-selector input {
  width: 60px;
  height: 40px;
  border: none;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  border-right: 1px solid rgba(0, 0, 0, 0.1);
  text-align: center;
  font-size: 1rem;
}

.product-actions {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
}

.btn-add-to-cart {
  flex: 1;
  padding: 1.25rem 2rem;
  font-size: 1rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.btn-wishlist {
  width: 60px;
  padding: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.product-trust-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 12px;
}

.trust-badge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
}

.trust-badge svg {
  color: #2ecc71;
}

.product-accordion {
  margin: 2rem 0;
}

.accordion-item {
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.accordion-item:last-child {
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.accordion-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.25rem 0;
  cursor: pointer;
  font-weight: 500;
  list-style: none;
}

.accordion-header::-webkit-details-marker {
  display: none;
}

.accordion-header svg {
  transition: transform 0.3s ease;
}

.accordion-item[open] .accordion-header svg {
  transform: rotate(180deg);
}

.accordion-content {
  padding-bottom: 1.25rem;
  line-height: 1.6;
  color: #666;
}

.accordion-content ul {
  list-style: none;
  padding: 0;
}

.accordion-content li {
  padding: 0.5rem 0;
}

.product-share {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding-top: 2rem;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.share-label {
  font-weight: 500;
}

.share-buttons {
  display: flex;
  gap: 0.5rem;
}

.share-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease;
  color: #000;
}

.share-btn:hover {
  background: rgba(0, 0, 0, 0.1);
}

@media (max-width: 768px) {
  .product-details {
    padding-left: 0;
    margin-top: 2rem;
  }
  
  .product-title {
    font-size: 1.75rem;
  }
  
  .price {
    font-size: 1.5rem;
  }
  
  .thumbnails-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .product-trust-badges {
    flex-direction: column;
    gap: 1rem;
  }
  
  .product-actions {
    flex-direction: column;
  }
  
  .btn-wishlist {
    width: 100%;
  }
}
</style>

<script>
// Product Template JavaScript
(function() {
  'use strict';
  
  // Quantity selector
  const quantityInput = document.querySelector('#quantity');
  const minusBtn = document.querySelector('.qty-btn.minus');
  const plusBtn = document.querySelector('.qty-btn.plus');
  
  if (minusBtn && plusBtn && quantityInput) {
    minusBtn.addEventListener('click', () => {
      const currentValue = parseInt(quantityInput.value);
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    });
    
    plusBtn.addEventListener('click', () => {
      const currentValue = parseInt(quantityInput.value);
      quantityInput.value = currentValue + 1;
    });
  }
  
  // Thumbnail gallery
  const thumbnails = document.querySelectorAll('.thumbnail-item');
  const mainImage = document.querySelector('.product-main-image img');
  
  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function() {
      thumbnails.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      const img = this.querySelector('img');
      if (mainImage && img) {
        mainImage.src = img.src.replace('200x200', '1000x1000');
      }
    });
  });
  
  // Variant selector
  const variantSelect = document.querySelector('.product-variant-select');
  if (variantSelect) {
    variantSelect.addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      // Variant changed - trigger ILS inventory check
      window.dispatchEvent(new CustomEvent('variant-changed', {
        detail: { variantId: selectedOption.value }
      }));
    });
  }
})();
</script>

{% schema %}
{
  "name": "NVC Enhanced Product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_related_products",
      "label": "Show related products",
      "default": true
    },
    {
      "type": "range",
      "id": "related_products_count",
      "min": 3,
      "max": 8,
      "step": 1,
      "label": "Number of related products",
      "default": 4
    }
  ]
}
{% endschema %}
