{% comment %}
  Optical Product Features
  - Frame specifications display
  - Virtual try-on integration
  - Prescription lens options
  - Size guide and fit finder
{% endcomment %}

{%- liquid
  assign frame_width = product.metafields.optical.frame_width
  assign lens_width = product.metafields.optical.lens_width
  assign bridge_width = product.metafields.optical.bridge_width
  assign temple_length = product.metafields.optical.temple_length
  assign frame_material = product.metafields.optical.frame_material
  assign lens_material = product.metafields.optical.lens_material
  assign frame_shape = product.metafields.optical.frame_shape
  assign frame_color = product.metafields.optical.frame_color
  assign prescription_compatible = product.metafields.optical.prescription_compatible
  assign uv_protection = product.metafields.optical.uv_protection
  assign polarized = product.metafields.optical.polarized
-%}

<style>
.nvc-optical-features {
  margin: 2rem 0;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 12px;
}

.nvc-optical-section {
  margin-bottom: 2rem;
}

.nvc-optical-section:last-child {
  margin-bottom: 0;
}

.nvc-optical-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0 0 1rem 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nvc-optical-title svg {
  width: 24px;
  height: 24px;
}

/* Frame Specifications */
.nvc-frame-specs {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 1rem;
}

.nvc-spec-item {
  padding: 1rem;
  background: white;
  border-radius: 8px;
  text-align: center;
  transition: all 0.3s ease;
}

.nvc-spec-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.nvc-spec-label {
  font-size: 0.75rem;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
}

.nvc-spec-value {
  font-size: 1.5rem;
  font-weight: 600;
  color: #000;
}

.nvc-spec-unit {
  font-size: 0.9rem;
  color: #666;
  margin-left: 0.25rem;
}

/* Frame Size Visual */
.nvc-frame-visual {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 1.5rem 0;
  padding: 2rem;
  background: white;
  border-radius: 12px;
}

.nvc-frame-diagram {
  position: relative;
  width: 280px;
  height: 80px;
}

.nvc-frame-diagram svg {
  width: 100%;
  height: 100%;
}

/* Material & Features */
.nvc-features-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.nvc-feature-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  background: white;
  border-radius: 8px;
}

.nvc-feature-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.nvc-feature-icon svg {
  width: 20px;
  height: 20px;
}

.nvc-feature-content {
  flex: 1;
}

.nvc-feature-title {
  font-weight: 600;
  font-size: 0.9rem;
  margin: 0 0 0.25rem 0;
}

.nvc-feature-desc {
  font-size: 0.8rem;
  color: #666;
  margin: 0;
}

/* Virtual Try-On Button */
.nvc-tryon-section {
  margin: 2rem 0;
}

.nvc-tryon-button {
  width: 100%;
  padding: 1.25rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.nvc-tryon-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.5s ease;
}

.nvc-tryon-button:hover::before {
  left: 100%;
}

.nvc-tryon-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
}

.nvc-tryon-button svg {
  width: 24px;
  height: 24px;
}

/* Size Guide */
.nvc-size-guide {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #000;
  text-decoration: none;
  font-weight: 500;
  padding: 0.75rem 1.25rem;
  border: 2px solid #000;
  border-radius: 8px;
  transition: all 0.3s ease;
  display: inline-flex;
}

.nvc-size-guide:hover {
  background: #000;
  color: #fff;
  transform: translateX(4px);
}

.nvc-size-guide svg {
  width: 20px;
  height: 20px;
}

/* Prescription Options */
.nvc-prescription-box {
  padding: 1.5rem;
  background: white;
  border: 2px dashed rgba(0, 0, 0, 0.2);
  border-radius: 12px;
  margin: 1rem 0;
}

.nvc-prescription-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.nvc-prescription-icon {
  width: 48px;
  height: 48px;
  background: rgba(102, 126, 234, 0.1);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nvc-prescription-icon svg {
  width: 24px;
  height: 24px;
  color: #667eea;
}

.nvc-prescription-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0;
}

.nvc-prescription-subtitle {
  font-size: 0.85rem;
  color: #666;
  margin: 0;
}

.nvc-prescription-options {
  display: grid;
  gap: 0.75rem;
  margin-top: 1rem;
}

.nvc-prescription-option {
  display: flex;
  align-items: center;
  padding: 1rem;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid transparent;
}

.nvc-prescription-option:hover {
  background: rgba(102, 126, 234, 0.05);
  border-color: rgba(102, 126, 234, 0.3);
}

.nvc-prescription-option input[type="radio"] {
  margin-right: 1rem;
}

.nvc-prescription-option-content {
  flex: 1;
}

.nvc-prescription-option-title {
  font-weight: 600;
  margin: 0 0 0.25rem 0;
}

.nvc-prescription-option-desc {
  font-size: 0.85rem;
  color: #666;
  margin: 0;
}

.nvc-prescription-option-price {
  font-weight: 600;
  color: #667eea;
}

/* Responsive */
@media (max-width: 768px) {
  .nvc-frame-specs {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .nvc-features-list {
    grid-template-columns: 1fr;
  }
  
  .nvc-frame-visual {
    padding: 1rem;
  }
}
</style>

<div class="nvc-optical-features">
  
  {% comment %} Frame Specifications {% endcomment %}
  {%- if lens_width or bridge_width or temple_length -%}
  <div class="nvc-optical-section">
    <h3 class="nvc-optical-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="7" width="20" height="10" rx="2"></rect>
        <line x1="2" y1="12" x2="22" y2="12"></line>
      </svg>
      Frame Specifications
    </h3>
    
    <div class="nvc-frame-specs">
      {%- if lens_width -%}
      <div class="nvc-spec-item">
        <div class="nvc-spec-label">Lens Width</div>
        <div class="nvc-spec-value">
          {{ lens_width }}<span class="nvc-spec-unit">mm</span>
        </div>
      </div>
      {%- endif -%}
      
      {%- if bridge_width -%}
      <div class="nvc-spec-item">
        <div class="nvc-spec-label">Bridge</div>
        <div class="nvc-spec-value">
          {{ bridge_width }}<span class="nvc-spec-unit">mm</span>
        </div>
      </div>
      {%- endif -%}
      
      {%- if temple_length -%}
      <div class="nvc-spec-item">
        <div class="nvc-spec-label">Temple Length</div>
        <div class="nvc-spec-value">
          {{ temple_length }}<span class="nvc-spec-unit">mm</span>
        </div>
      </div>
      {%- endif -%}
      
      {%- if frame_width -%}
      <div class="nvc-spec-item">
        <div class="nvc-spec-label">Frame Width</div>
        <div class="nvc-spec-value">
          {{ frame_width }}<span class="nvc-spec-unit">mm</span>
        </div>
      </div>
      {%- endif -%}
    </div>
    
    {% comment %} Frame Size Visual {% endcomment %}
    <div class="nvc-frame-visual">
      <svg class="nvc-frame-diagram" viewBox="0 0 280 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Left lens -->
        <ellipse cx="60" cy="40" rx="40" ry="30" fill="none" stroke="#000" stroke-width="2"/>
        <!-- Bridge -->
        <line x1="100" y1="40" x2="180" y2="40" stroke="#000" stroke-width="2"/>
        <!-- Right lens -->
        <ellipse cx="220" cy="40" rx="40" ry="30" fill="none" stroke="#000" stroke-width="2"/>
        <!-- Temple left -->
        <line x1="20" y1="40" x2="10" y2="40" stroke="#000" stroke-width="2"/>
        <!-- Temple right -->
        <line x1="260" y1="40" x2="270" y2="40" stroke="#000" stroke-width="2"/>
      </svg>
    </div>
    
    <a href="#size-guide" class="nvc-size-guide">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
      </svg>
      View Size Guide
    </a>
  </div>
  {%- endif -%}
  
  {% comment %} Materials & Features {% endcomment %}
  <div class="nvc-optical-section">
    <h3 class="nvc-optical-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
        <path d="M2 17l10 5 10-5"></path>
        <path d="M2 12l10 5 10-5"></path>
      </svg>
      Materials & Features
    </h3>
    
    <div class="nvc-features-list">
      {%- if frame_material -%}
      <div class="nvc-feature-item">
        <div class="nvc-feature-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          </svg>
        </div>
        <div class="nvc-feature-content">
          <h4 class="nvc-feature-title">Frame Material</h4>
          <p class="nvc-feature-desc">{{ frame_material }}</p>
        </div>
      </div>
      {%- endif -%}
      
      {%- if lens_material -%}
      <div class="nvc-feature-item">
        <div class="nvc-feature-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
          </svg>
        </div>
        <div class="nvc-feature-content">
          <h4 class="nvc-feature-title">Lens Material</h4>
          <p class="nvc-feature-desc">{{ lens_material }}</p>
        </div>
      </div>
      {%- endif -%}
      
      {%- if uv_protection == 'true' -%}
      <div class="nvc-feature-item">
        <div class="nvc-feature-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </div>
        <div class="nvc-feature-content">
          <h4 class="nvc-feature-title">UV Protection</h4>
          <p class="nvc-feature-desc">100% UVA/UVB protection</p>
        </div>
      </div>
      {%- endif -%}
      
      {%- if polarized == 'true' -%}
      <div class="nvc-feature-item">
        <div class="nvc-feature-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
          </svg>
        </div>
        <div class="nvc-feature-content">
          <h4 class="nvc-feature-title">Polarized Lenses</h4>
          <p class="nvc-feature-desc">Reduces glare & enhances clarity</p>
        </div>
      </div>
      {%- endif -%}
    </div>
  </div>
  
  {% comment %} Virtual Try-On {% endcomment %}
  {%- if settings.enable_virtual_tryon -%}
  <div class="nvc-optical-section nvc-tryon-section">
    <button type="button" class="nvc-tryon-button" id="nvcVirtualTryOn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
      Try On Virtually
    </button>
  </div>
  {%- endif -%}
  
  {% comment %} Prescription Options {% endcomment %}
  {%- if prescription_compatible == 'true' -%}
  <div class="nvc-optical-section">
    <div class="nvc-prescription-box">
      <div class="nvc-prescription-header">
        <div class="nvc-prescription-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
        </div>
        <div>
          <h3 class="nvc-prescription-title">Add Prescription Lenses</h3>
          <p class="nvc-prescription-subtitle">This frame is compatible with prescription lenses</p>
        </div>
      </div>
      
      <div class="nvc-prescription-options">
        <label class="nvc-prescription-option">
          <input type="radio" name="prescription" value="none" checked>
          <div class="nvc-prescription-option-content">
            <p class="nvc-prescription-option-title">No prescription lenses</p>
            <p class="nvc-prescription-option-desc">Standard non-prescription lenses</p>
          </div>
          <div class="nvc-prescription-option-price">Included</div>
        </label>
        
        <label class="nvc-prescription-option">
          <input type="radio" name="prescription" value="single">
          <div class="nvc-prescription-option-content">
            <p class="nvc-prescription-option-title">Single Vision Lenses</p>
            <p class="nvc-prescription-option-desc">For distance or reading</p>
          </div>
          <div class="nvc-prescription-option-price">+ £79</div>
        </label>
        
        <label class="nvc-prescription-option">
          <input type="radio" name="prescription" value="progressive">
          <div class="nvc-prescription-option-content">
            <p class="nvc-prescription-option-title">Progressive Lenses</p>
            <p class="nvc-prescription-option-desc">Multifocal for all distances</p>
          </div>
          <div class="nvc-prescription-option-price">+ £149</div>
        </label>
      </div>
    </div>
  </div>
  {%- endif -%}
  
</div>

<script>
(function() {
  'use strict';
  
  // Virtual try-on handler
  document.getElementById('nvcVirtualTryOn')?.addEventListener('click', function() {
    // Trigger virtual try-on - integrate with your ILS virtual try-on service
    window.dispatchEvent(new CustomEvent('nvc:open-virtual-tryon', {
      detail: {
        productId: {{ product.id | json }},
        productTitle: {{ product.title | json }}
      }
    }));
    
    // Placeholder: You can integrate with services like:
    // - Ditto
    // - Topology Eyewear
    // - Your ILS's built-in virtual try-on
    // Virtual try-on triggered
  });
  
  // Prescription option change handler
  document.querySelectorAll('input[name="prescription"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const value = this.value;
      window.dispatchEvent(new CustomEvent('nvc:prescription-changed', {
        detail: { prescriptionType: value }
      }));
      // Prescription option changed
    });
  });
})();
</script>
